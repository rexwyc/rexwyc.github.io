<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Prison Escape - Monster Chase!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0b3a4f, #1b5e7a);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-wrapper {
            background: #1e3b4f;
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 3px solid #5f9ea0;
        }

        .game-panel {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .game-area {
            background: #2c5e6b;
            padding: 20px;
            border-radius: 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }

        canvas {
            border: 4px solid #8b6b4d;
            border-radius: 15px;
            background: #7ec8e0;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            display: block;
        }

        .info-panel {
            background: #2c5e6b;
            padding: 25px;
            border-radius: 20px;
            min-width: 250px;
            color: white;
            border: 3px solid #8b6b4d;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
        }

        .info-title {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .stats {
            background: #1e3b4f;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #8b6b4d;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 18px;
        }

        .danger-meter {
            background: #1e3b4f;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #ff4444;
        }

        .danger-bar {
            width: 100%;
            height: 25px;
            background: #440000;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            border: 2px solid #ff8888;
        }

        .danger-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff8800, #ff0000);
            width: 0%;
            transition: width 0.3s;
        }

        .inventory-box {
            background: #1e3b4f;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #8b6b4d;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .inventory-slot {
            background: #2c5e6b;
            border: 2px solid #8b6b4d;
            border-radius: 10px;
            padding: 10px 5px;
            text-align: center;
            font-size: 14px;
            color: #ffd700;
        }

        .controls {
            background: #1e3b4f;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #8b6b4d;
        }

        .control-key {
            display: inline-block;
            background: #2c5e6b;
            border: 2px solid #ffd700;
            color: #ffd700;
            padding: 8px 15px;
            border-radius: 10px;
            margin: 3px;
            font-weight: bold;
        }

        .message-log {
            background: #1e3b4f;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
            border: 2px solid #8b6b4d;
        }

        .message {
            color: #98f0ff;
            margin: 5px 0;
            font-size: 14px;
            border-left: 3px solid #ffd700;
            padding-left: 8px;
        }

        .danger-message {
            border-left-color: #ff4444;
            color: #ff8888;
            font-weight: bold;
        }

        button {
            background: #ffd700;
            color: #1e3b4f;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            border: 2px solid #8b6b4d;
            transition: all 0.3s;
        }

        button:hover {
            background: #ffed4a;
            transform: scale(1.02);
        }

        .win-message, .lose-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border-radius: 30px;
            font-size: 36px;
            text-align: center;
            border: 4px solid;
            display: none;
            z-index: 1000;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        .win-message {
            color: #ffd700;
            border-color: #ffd700;
        }

        .lose-message {
            color: #ff4444;
            border-color: #ff4444;
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="game-panel">
            <div class="game-area">
                <canvas id="gameCanvas" width="500" height="500"></canvas>
            </div>
            
            <div class="info-panel">
                <div class="info-title">üèùÔ∏è Prison garden üèùÔ∏è</div>
                
                <div class="stats">
                    <div class="stat-item">
                        <span>üìç Position:</span>
                        <span id="position">(0,0)</span>
                    </div>
                    <div class="stat-item">
                        <span>üéí Items:</span>
                        <span id="itemCount">0/6</span>
                    </div>
                </div>

                <div class="danger-meter">
                    <div style="display: flex; justify-content: space-between;">
                        <span>üëÆüèª‚Äç‚ôÇÔ∏è POLICE PROXIMITY</span>
                        <span id="distance">??</span>
                    </div>
                    <div class="danger-bar">
                        <div class="danger-fill" id="dangerFill" style="width: 0%"></div>
                    </div>
                    <div id="monsterDirection" style="text-align: center; font-size: 14px; color: #ff8888;"></div>
                </div>

                <div class="inventory-box">
                    <div style="text-align: center; margin-bottom: 10px;">INVENTORY</div>
                    <div class="inventory-grid" id="inventoryGrid">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <div class="controls">
                    <div style="text-align: center; margin-bottom: 10px;">CONTROLS</div>
                    <div style="text-align: center;">
                        <span class="control-key">‚Üë</span>
                    </div>
                    <div style="text-align: center;">
                        <span class="control-key">‚Üê</span>
                        <span class="control-key">‚Üì</span>
                        <span class="control-key">‚Üí</span>
                    </div>
                    <div style="text-align: center; margin-top: 8px;">
                        <span class="control-key">SPACE</span> interact
                    </div>
                </div>

                <button onclick="resetGame();playAudio()">üîÑ New Game</button>
            </div>
        </div>

        <div class="message-log" id="messageLog">
            <div class="message">üèùÔ∏è Washed ashore on PRISON...</div>
            <div class="message danger-message">üëÆüèª‚Äç‚ôÇÔ∏è Something is stalking you...</div>
            <div class="message">Find 3 items and reach the boat!</div>
        </div>
    </div>

    <div class="win-message" id="winMessage">
        üéâ YOU ESCAPED! üéâ
        <div style="font-size: 20px; margin: 20px 0;">You narrowly escaped from prison!</div>
        <button onclick="resetGame()" style="width: auto; margin-top: 20px;">Play Again</button>
    </div>

    <div class="lose-message" id="loseMessage">
        üëÆüèª‚Äç‚ôÇÔ∏è YOU GET CAUGHT üëÆüèª‚Äç‚ôÇÔ∏è
        <div style="font-size: 20px; margin: 20px 0;">The police caught you!</div>
        <button onclick="resetGame()" style="width: auto; margin-top: 20px;">Try Again</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game constants
        const GRID_SIZE = 10;
        const CELL_SIZE = 50;
        const PLAYER = { x: 0, y: 0 };
        const MONSTER = { x: 9, y: 9 }; // Monster starts in opposite corner

        // Game state
        let gameRunning = true;
        let inventory = [];
        let messages = [];
        let monsterMoveCounter = 0;
        const MONSTER_SPEED = 1; // Monster moves every 3 player moves

        // Items on map
        const items = [
            { name: 'üî¶ Flashlight', x: 3, y: 2, collected: false },
            { name: 'üíß Water Bottle', x: 7, y: 1, collected: false },
            { name: 'üó∫Ô∏è Map', x: 2, y: 7, collected: false },
            { name: 'üîë Key', x: 8, y: 8, collected: false },
            { name: 'ü™ì Axe', x: 5, y: 4, collected: false },
            { name: 'üßØ Flare Gun', x: 4, y: 9, collected: false }
        ];

        // Obstacles (trees, rocks)
        const obstacles = [
            { x: 2, y: 3, type: 'üå≤' },
            { x: 4, y: 2, type: 'üå≤' },
            { x: 6, y: 5, type: 'ü™®' },
            { x: 3, y: 8, type: 'üå≤' },
            { x: 7, y: 7, type: 'ü™®' }
        ];

        // Escape boat location
        const BOAT = { x: 9, y: 0 };

        // Add message to log
        function addMessage(text, isDanger = false) {
            messages.unshift(text);
            if (messages.length > 6) messages.pop();
            
            const log = document.getElementById('messageLog');
            log.innerHTML = messages.map(m => {
                const isDangerMsg = m.includes('üëÆüèª‚Äç‚ôÇÔ∏è') || m.includes('üíÄ');
                return `<div class="message ${isDangerMsg ? 'danger-message' : ''}">${m}</div>`;
            }).join('');
        }

        // Calculate distance between two points
        function getDistance(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }

        // Get direction to monster
        function getMonsterDirection() {
            const dx = MONSTER.x - PLAYER.x;
            const dy = MONSTER.y - PLAYER.y;
            
            if (Math.abs(dx) > Math.abs(dy)) {
                return dx > 0 ? '‚Üê coming from right' : '‚Üí coming from left';
            } else {
                return dy > 0 ? '‚Üë coming from below' : '‚Üì coming from above';
            }
        }

        // Move monster towards player
        function moveMonster() {
            if (!gameRunning) return;

            monsterMoveCounter++;
            if (monsterMoveCounter < MONSTER_SPEED) return;
            
            monsterMoveCounter = 0;

            // Calculate direction to player
            const dx = PLAYER.x - MONSTER.x;
            const dy = PLAYER.y - MONSTER.y;
            
            // Try to move in the best direction (avoid obstacles)
            const moves = [];
            
            if (Math.abs(dx) > Math.abs(dy)) {
                // Prioritize horizontal movement
                if (dx > 0) moves.push({ x: 1, y: 0 });
                else if (dx < 0) moves.push({ x: -1, y: 0 });
                if (dy > 0) moves.push({ x: 0, y: 1 });
                else if (dy < 0) moves.push({ x: 0, y: -1 });
            } else {
                // Prioritize vertical movement
                if (dy > 0) moves.push({ x: 0, y: 1 });
                else if (dy < 0) moves.push({ x: 0, y: -1 });
                if (dx > 0) moves.push({ x: 1, y: 0 });
                else if (dx < 0) moves.push({ x: -1, y: 0 });
            }

            // Try each move
            for (let move of moves) {
                const newX = MONSTER.x + move.x;
                const newY = MONSTER.y + move.y;
                
                // Check boundaries
                if (newX < 0 || newX >= GRID_SIZE || newY < 0 || newY >= GRID_SIZE) continue;
                
                // Check obstacles
                const obstacle = obstacles.find(o => o.x === newX && o.y === newY);
                if (obstacle) continue;
                
                // Check if monster caught player
                if (newX === PLAYER.x && newY === PLAYER.y) {
                    gameOver();
                    return;
                }
                
                // Move monster
                MONSTER.x = newX;
                MONSTER.y = newY;
                
                // Check if monster caught player after move
                if (MONSTER.x === PLAYER.x && MONSTER.y === PLAYER.y) {
                    gameOver();
                    return;
                }
                
                break;
            }

            // Update danger UI
            updateDangerMeter();
        }

        // Update danger meter based on monster proximity
        function updateDangerMeter() {
            const distance = getDistance(PLAYER.x, PLAYER.y, MONSTER.x, MONSTER.y);
            const maxDistance = Math.sqrt(Math.pow(GRID_SIZE, 2) + Math.pow(GRID_SIZE, 2));
            const dangerPercent = 100 - (distance / maxDistance * 100);
            
            document.getElementById('dangerFill').style.width = dangerPercent + '%';
            document.getElementById('distance').textContent = Math.round(distance * 10) / 10 + 'm';
            
            if (distance < 3) {
                document.getElementById('monsterDirection').innerHTML = 'üëÆüèª‚Äç‚ôÇÔ∏è VERY CLOSE! ' + getMonsterDirection();
                document.getElementById('monsterDirection').style.color = '#ff0000';
                document.getElementById('monsterDirection').className = 'pulse';
            } else if (distance < 5) {
                document.getElementById('monsterDirection').innerHTML = 'üëÆüèª‚Äç‚ôÇÔ∏è Getting closer! ' + getMonsterDirection();
                document.getElementById('monsterDirection').style.color = '#ff8800';
                document.getElementById('monsterDirection').className = '';
            } else {
                document.getElementById('monsterDirection').innerHTML = 'üëÆüèª‚Äç‚ôÇÔ∏è ' + getMonsterDirection();
                document.getElementById('monsterDirection').style.color = '#ff8888';
                document.getElementById('monsterDirection').className = '';
            }
        }

        // Game over - monster caught player
        function gameOver() {
            gameRunning = false;
            document.getElementById('loseMessage').style.display = 'block';
            addMessage('üíÄ The police caught you! Game Over!', true);
            draw(); // Redraw to show monster catching player
        }

        // Draw game
        function draw() {
            ctx.clearRect(0, 0, 500, 500);

            // Draw grid
            for (let i = 0; i <= GRID_SIZE; i++) {
                ctx.beginPath();
                ctx.strokeStyle = '#5f4c3b';
                ctx.lineWidth = 1;
                ctx.moveTo(i * CELL_SIZE, 0);
                ctx.lineTo(i * CELL_SIZE, canvas.height);
                ctx.stroke();
                
                ctx.moveTo(0, i * CELL_SIZE);
                ctx.lineTo(canvas.width, i * CELL_SIZE);
                ctx.stroke();
            }

            // Draw terrain types
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    if (x < 2 && y < 2) {
                        // Beach area
                        ctx.fillStyle = '#f5e68b';
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE-1, CELL_SIZE-1);
                        
                        // Sand dots
                        ctx.fillStyle = '#d4b87a';
                        ctx.beginPath();
                        ctx.arc(x * CELL_SIZE + 25, y * CELL_SIZE + 25, 2, 0, Math.PI * 2);
                        ctx.fill();
                    } else if (x > 7 && y < 2) {
                        // Water near boat
                        ctx.fillStyle = '#4aa3c9';
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE-1, CELL_SIZE-1);
                        
                        // Ripples
                        ctx.strokeStyle = '#ffffff60';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(x * CELL_SIZE + 25, y * CELL_SIZE + 25, 10, 0, Math.PI * 2);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.arc(x * CELL_SIZE + 25, y * CELL_SIZE + 25, 15, 0, Math.PI * 2);
                        ctx.stroke();
                    } else {
                        // Jungle
                        ctx.fillStyle = '#2e7d32';
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE-1, CELL_SIZE-1);
                        
                        // Grass details
                        ctx.fillStyle = '#1b5e20';
                        for (let i = 0; i < 3; i++) {
                            ctx.beginPath();
                            ctx.arc(x * CELL_SIZE + 10 + i*15, y * CELL_SIZE + 15, 3, 0, Math.PI * 2);
                            ctx.fill();
                        }
                    }
                }
            }

            // Draw obstacles
            obstacles.forEach(obs => {
                ctx.font = '30px Arial';
                ctx.fillStyle = '#3d2b1a';
                ctx.fillText(obs.type, obs.x * CELL_SIZE + 10, obs.y * CELL_SIZE + 35);
                
                // Add shadow for trees
                if (obs.type === 'üå≤') {
                    ctx.fillStyle = '#2d1f12';
                    ctx.beginPath();
                    ctx.ellipse(obs.x * CELL_SIZE + 30, obs.y * CELL_SIZE + 40, 8, 3, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // Draw items
            items.forEach(item => {
                if (!item.collected) {
                    ctx.font = '28px Arial';
                    ctx.fillStyle = '#ffd700';
                    ctx.fillText(item.name, item.x * CELL_SIZE + 12, item.y * CELL_SIZE + 35);
                    
                    // Glow effect
                    ctx.shadowColor = '#ffd700';
                    ctx.shadowBlur = 10;
                    ctx.fillText(item.name, item.x * CELL_SIZE + 12, item.y * CELL_SIZE + 35);
                    ctx.shadowBlur = 0;
                }
            });

            // Draw boat
            ctx.font = '40px Arial';
            ctx.fillStyle = '#8b4513';
            ctx.fillText('üö§', BOAT.x * CELL_SIZE + 8, BOAT.y * CELL_SIZE + 40);
            
            // Boat reflection in water
            ctx.globalAlpha = 0.3;
            ctx.fillText('üö§', BOAT.x * CELL_SIZE + 8, BOAT.y * CELL_SIZE + 45);
            ctx.globalAlpha = 1;

            // Draw monster (if game is running or game over)
            if (MONSTER.x !== undefined) {
                // Monster glow (pulse when close)
                const distance = getDistance(PLAYER.x, PLAYER.y, MONSTER.x, MONSTER.y);
                if (distance < 3) {
                    ctx.shadowColor = '#ff0000';
                    ctx.shadowBlur = 20 + Math.sin(Date.now() * 0.01) * 10;
                } else {
                    ctx.shadowColor = '#660000';
                    ctx.shadowBlur = 10;
                }
                
                ctx.font = '45px Arial';
                ctx.fillStyle = '#8b0000';
                ctx.fillText('üëÆüèª‚Äç‚ôÇÔ∏è', MONSTER.x * CELL_SIZE + 5, MONSTER.y * CELL_SIZE + 42);
                ctx.shadowBlur = 0;
            }

            // Draw player
            ctx.shadowColor = '#ffffff';
            ctx.shadowBlur = 15;
            ctx.font = '45px Arial';
            ctx.fillStyle = '#ff4444';
            ctx.fillText('üë¥üèø', PLAYER.x * CELL_SIZE + 8, PLAYER.y * CELL_SIZE + 42);
            ctx.shadowBlur = 0;

            // Update UI
            document.getElementById('position').textContent = `(${PLAYER.x},${PLAYER.y})`;
            document.getElementById('itemCount').textContent = `${inventory.length}/6`;

            // Update inventory grid
            const invGrid = document.getElementById('inventoryGrid');
            invGrid.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                slot.textContent = inventory[i] || '‚¨ú';
                invGrid.appendChild(slot);
            }

            // Update danger meter
            updateDangerMeter();
        }

        // Move player
        function movePlayer(dx, dy) {
            if (!gameRunning) return;

            const newX = PLAYER.x + dx;
            const newY = PLAYER.y + dy;

            // Check boundaries
            if (newX < 0 || newX >= GRID_SIZE || newY < 0 || newY >= GRID_SIZE) {
                addMessage('‚ùå Can\'t leave the island!');
                return;
            }

            // Check obstacles
            const obstacle = obstacles.find(o => o.x === newX && o.y === newY);
            if (obstacle) {
                addMessage(`‚ùå Blocked by a ${obstacle.type === 'üå≤' ? 'tree' : 'rock'}!`);
                return;
            }

            // Check if monster is there
            if (newX === MONSTER.x && newY === MONSTER.y) {
                gameOver();
                return;
            }

            // Move player
            PLAYER.x = newX;
            PLAYER.y = newY;

            // Check for items
            const item = items.find(i => i.x === PLAYER.x && i.y === PLAYER.y && !i.collected);
            if (item) {
                item.collected = true;
                inventory.push(item.name);
                addMessage(`‚úÖ Found: ${item.name}`);
            }

            // Check if reached boat
            if (PLAYER.x === BOAT.x && PLAYER.y === BOAT.y) {
                if (inventory.length >= 3) {
                    gameRunning = false;
                    document.getElementById('winMessage').style.display = 'block';
                    addMessage('üéâ YOU ESCAPED THE ISLAND! üéâ');
                } else {
                    addMessage('‚ùå Need at least 3 items to use the boat!');
                }
            }

            // Move monster after player moves
            moveMonster();

            draw();
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            switch(e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    movePlayer(0, -1);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    movePlayer(0, 1);
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    movePlayer(-1, 0);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    movePlayer(1, 0);
                    break;
                case ' ':
                    e.preventDefault();
                    // Interact with current tile
                    const item = items.find(i => i.x === PLAYER.x && i.y === PLAYER.y && !i.collected);
                    if (item) {
                        item.collected = true;
                        inventory.push(item.name);
                        addMessage(`‚úÖ Picked up: ${item.name}`);
                        moveMonster(); // Monster still moves when you interact
                        draw();
                    } else {
                        addMessage('‚ùå Nothing to interact with here');
                    }
                    break;
            }
        });

        // Reset game
        function resetGame() {
            PLAYER.x = 0;
            PLAYER.y = 0;
            MONSTER.x = 9;
            MONSTER.y = 9;
            inventory = [];
            items.forEach(item => item.collected = false);
            gameRunning = true;
            monsterMoveCounter = 0;
            messages = [
                'üèùÔ∏è Washed ashore on Monster Island...',
                'üßîüèº‚Äç‚ôÇÔ∏è Something is stalking you...',
                'Find 3 items and reach the boat!'
            ];
            document.getElementById('winMessage').style.display = 'none';
            document.getElementById('loseMessage').style.display = 'none';
            addMessage('üîÑ Game reset! Run!');
            draw();
        }

        // Start game
        resetGame();

        // Touch controls for mobile
        let touchStart = { x: 0, y: 0 };
        
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStart.x = e.touches[0].clientX;
            touchStart.y = e.touches[0].clientY;
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (!touchStart.x || !gameRunning) return;

            const dx = e.changedTouches[0].clientX - touchStart.x;
            const dy = e.changedTouches[0].clientY - touchStart.y;

            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > 50) movePlayer(1, 0);
                else if (dx < -50) movePlayer(-1, 0);
            } else {
                if (dy > 50) movePlayer(0, 1);
                else if (dy < -50) movePlayer(0, -1);
            }

            touchStart = { x: 0, y: 0 };
        });
        
        function playAudio() { 
            var a = document.getElementById("myAudio");
            a.loop = true; // Fixed: was 'audio.loop' but should be 'a.loop'
            if (a.paused) {
                a.play();
            }
        };
    </script>
     
    <audio id="myAudio" src="music/sunshine.wav"></audio>

</body>
</html>